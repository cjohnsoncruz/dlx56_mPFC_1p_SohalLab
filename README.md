# dlx56_mPFC_1p_SohalLab
Code used to create data visualizations published in "Circuit inhibition promotes the dynamic reorganization of prefrontal task encoding to support cognitive flexibility".

## Overview
This repository contains Jupyter notebooks and Python utilities to reproduce the analyses and figures for the manuscript.

 The workflow can be executed either by running the notebooks directly or by using a script runner that executes them programmatically.

Key components:
- Notebooks under `code/` that generate Figures 1–7 and Supplementary Figures.
- Shared plotting/analysis utilities under `code/Function .py Storage/`.
- A script runner `code/main.py` that executes all figure notebooks headlessly and saves the executed copies under `results/`.
- Data samples in `data/` for testing and demonstration.

## Repository structure
- `code/`
  - `main.py`: Executes the figure notebooks using `nbclient`. It sets the working directory for notebooks to `code/` and writes executed notebooks to `results/executed_notebooks/`.
  - `notebook_setup.py`: Helper to make local imports robust when running notebooks interactively. It adds `code/Function .py Storage/` and its submodule path to `sys.path`.
  - `Function .py Storage/`: Shared Python modules used across notebooks.
    - `helper_functions.py`: Figure saving utilities and helpers. It now saves figures into this repo’s `results/` directory.
    - Other helpers (plotting styles, preprocessing, statistics, etc.).
  - `Figure *.ipynb`: Notebooks for each figure in the manuscript.
- `data/`: Example datasets (CSV/Parquet/Excel/Mat files) used by notebooks.
- `results/`: Outputs generated by scripts and notebooks (ignored by Git, except for an optional `.gitkeep`).
- `environment.yaml`: Conda environment for reproducibility.

## Environment setup
Create and activate the Conda environment:
```bash
conda env create -f environment.yaml
conda activate dlx56_mPFC_1p_SohalLab
```
If you prefer pip, mirror the packages from `environment.yaml` manually (Conda is recommended).

## Running the workflow
### 1) Execute all notebooks via script (recommended for batch runs)
From the repository root:
```bash
python .\code\main.py
```
This will:
- Execute each figure notebook with `nbclient`.
- Save executed notebooks to `results/executed_notebooks/`.
- Ensure relative paths inside notebooks resolve to `code/`.

### 2) Run notebooks interactively
In the first cell of a notebook, you can optionally add:
```python
%load_ext autoreload
%autoreload 2
import notebook_setup; notebook_setup.setup()
```
This ensures imports from `code/Function .py Storage/` work reliably.

## Where results are saved
- Executed notebooks: `results/executed_notebooks/`
- Figures: under `results/fig_{N}/<date>/...` and `results/supp_fig_{N}/<date>/...`
  - Implemented via `save_fig_in_main_fig_dir()` in `code/Function .py Storage/helper_functions.py`.
  - The base save root is computed relative to this repository: `results/`.

Git ignores `results/` contents by default (see `.gitignore`). If you need the folder present in a fresh clone, add an empty `results/.gitkeep`.

## Data
The `data/` directory contains sample files used by notebooks (e.g., `.parquet`, `.xlsx`, `.csv`, `.mat`). For full analyses, ensure the expected inputs are present or update paths in the notebooks accordingly.

## Reproducibility notes
- Windows async: `code/main.py` sets a Windows selector event loop policy for compatibility with notebook execution.
- Paths: All save paths were updated to be repository-relative to avoid reliance on Google Drive letters.
- Determinism: Some analyses may involve randomness (e.g., resampling). Seed control is not enforced globally unless specified inside notebooks/utilities.

## Troubleshooting
- Figures not appearing in expected folders:
  - Confirm you’re running from the repo root and using the updated `main.py`.
  - Check `results/` exists and is writable.
- Import errors in notebooks:
  - Run `import notebook_setup; notebook_setup.setup()` in the first cell.
  - Ensure your Conda env is activated.
- Git ignores outputs:
  - `results/` is ignored; commit only curated artifacts if necessary by moving/copying them outside `results/`.

See `LICENSE` for the main project license
