# dlx56_mPFC_1p_SohalLab
Code used to create data visualizations published in "Circuit inhibition promotes the dynamic reorganization of prefrontal task encoding to support cognitive flexibility", currently accessable as a preprint on bioarxiv: https://www.biorxiv.org/content/10.1101/2025.08.09.669414v1 .

## Overview
This repo contains Jupyter notebooks and Python utilities to reproduce the analyses and figures generated from saved datasets located in /data/. Workflow can be executed either by running the notebooks directly or (preferrably) by using a script *main.py* that executes them programmatically.

Key components:
- Notebooks under `code/` that generates and saves .png files of panels used in Figures 1–7 and Supplementary Figures 1-2.
- Shared plotting/analysis utilities under `code/Function .py Storage/`.
- A script runner `code/main.py` that executes all figure notebooks headlessly and saves the executed copies under `results/`.
- Data used to generate the figures, in `data/`.
 - `requirements.txt`: Pip requirements for reproducibility (Python 3.10.x).

## Repository structure
- `code/`
  - `main.py`: Executes the figure notebooks using `nbclient`. It sets the working directory for notebooks to `code/` and writes executed notebooks to `results/executed_notebooks/`.
  - `notebook_setup.py`: Helper to make local imports robust when running notebooks interactively. It adds `code/Function .py Storage/` and its submodule path to `sys.path`.
  - `Function .py Storage/`: Shared Python modules used across notebooks.
    - `helper_functions.py`: Figure saving utilities and helpers. It now saves figures into this repo’s `results/` directory.
    - Other helpers (plotting styles, preprocessing, statistics, etc.).
  - `Figure *.ipynb`: Notebooks for each figure in the manuscript.
- `data/`: Example datasets (CSV/Parquet/Excel/Mat files) used by notebooks.
- `results/`: Outputs generated by scripts and notebooks (ignored by Git, except for an optional `.gitkeep`).
- `requirements.txt`: Pip requirements for reproducibility.

## Environment setup (pip)
Use Python 3.10.x (tested with 3.10.12). Create and activate a virtual environment, then install from `requirements.txt`.
Has been verified on Windows 11 only.

Windows (PowerShell):
```powershell
py -3.10 -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install --upgrade pip
pip install -r requirements.txt
```

macOS/Linux:
```bash
python3.10 -m venv .venv
source .venv/bin/activate
python -m pip install --upgrade pip
pip install -r requirements.txt
```

Optional (Conda):
```bash
conda env create -f environment.yaml
conda activate mPFC_1p_analysis
```

## Running the workflow
### 1) Execute all notebooks via script (recommended for batch runs)
From the repository root:
```bash
python .\code\main.py
```
This will:
- Execute each figure notebook with `nbclient`.
- Save executed notebooks to `results/executed_notebooks/`.
- Ensure relative paths inside notebooks resolve to `code/`.

## Results save locations
- Executed notebooks: `results/executed_notebooks/`
- Figures: under `results/fig_{N}/<date>/...` and `results/supp_fig_{N}/<date>/...`
  - Implemented via `save_fig_in_main_fig_dir()` in `code/Function .py Storage/helper_functions.py`.
  - The base save root is computed relative to this repository: `results/`.

Git ignores `results/` contents by default (see `.gitignore`). If you need the folder present in a fresh clone, add an empty `results/.gitkeep`.

## Data locations
The `data/` directory contains sample files used by notebooks (e.g., `.parquet`, `.xlsx`, `.csv`, `.mat`). For full analyses, ensure the expected inputs are present or update paths in the notebooks accordingly.

## Reproducibility notes
- All save paths are repository-relative.
- Some analyses may involve randomness (e.g., using permutation testing). Seeds are set inside notebooks but not enforced globally.

## Troubleshooting
- Figures not appearing in expected folders:
  - Confirm you’re running from the repo root and using the updated `main.py`.
  - Check `results/` exists and is writable.
- Import errors in notebooks:
  - Run `import notebook_setup; notebook_setup.setup()` in the first cell.
  - Ensure your virtual environment is activated (or the correct Conda env, if using Conda).
- Git ignores outputs:
  - `results/` is ignored; commit only curated artifacts if necessary by moving/copying them outside `results/`.

See `LICENSE` for the main project license